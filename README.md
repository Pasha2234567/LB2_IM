# Лабораторная работа №2: Датчики псевдослучайных чисел

## Ссылки на коды
- [custom_rng.h](custom_rng.h) - Заголовочный файл с объявлениями функций генераторов.
- [custom_rng.cpp](custom_rng.cpp) - Реализация генераторов псевдослучайных чисел (равномерного, нормального и экспоненциального распределений).
- [test_rng.cpp](test_rng.cpp) - Код для тестирования генераторов, включая сравнение с библиотечными.

## Общее описание алгоритма ГПСЧ и его реализации
Алгоритм генератора псевдослучайных чисел (ГПСЧ) для равномерного распределения на интервале [0, 1) основан на методе умножения с использованием 32-битной signed переменной для имитации переполнения, как описано в материалах лабораторной работы. Инициализация статической переменной `b` происходит с помощью `time(NULL)` для обеспечения различных последовательностей при каждом запуске. На каждой итерации вычисляется `y = b * 1220703125`; если `y < 0`, добавляется `2 * 1073741824` для коррекции; результат нормализуется умножением на `4.656613e-10f`; затем `b` обновляется значением `y`. Этот подход обеспечивает длинный период (более 2 миллиардов чисел) и свойства, близкие к случайным, при условии отключения строгих проверок переполнения в компиляторе.

Реализация на C++ выполнена в файлах `custom_rng.h` и `custom_rng.cpp`. Для нормального распределения N(mean, stddev²) применяется центральная предельная теорема: генерируется 12 равномерных чисел, суммируются, отцентрируются и масштабируются с учетом стандартного отклонения. Для экспоненциального распределения с параметром λ используется метод обратной функции: генерируется равномерное `r`, затем вычисляется `-log(r) / λ`. Функции возвращают динамически выделенные массивы `float*`, требующие освобождения памяти в тестах. Сравнение проводится с библиотечным генератором из `<random>` (Mersenne Twister).

## Краткое изложение идеи выбранных методов тестирования
### Тест на равномерность (визуальный метод - гистограмма)
Идея визуального теста на равномерность заключается в построении гистограммы распределения сгенерированных чисел по интервалам (биннам). Для равномерного распределения на [0, 1) с 10 биннами частоты в каждом должны быть примерно равными (около N/10 = 1000 для N=10000). Это позволяет графически оценить отклонения: равномерные столбцы указывают на хорошее распределение, пики или провалы — на проблемы. Для нормального и экспоненциального распределений форма гистограммы (колокол и убывающая кривая соответственно) сравнивается с теоретическими ожиданиями. Метод прост и интуитивен, но субъективен, поэтому дополняется статистическим тестом.

### Тест на равномерность (статистический метод - хи-квадрат)
Статистический тест хи-квадрат проверяет гипотезу о равномерном распределении путем сравнения наблюдаемых частот в биннах с ожидаемыми (N/биннов). Вычисляется статистика χ² = Σ((observed - expected)² / expected), затем p-value на основе распределения χ² с (биннов-1) степенями свободы. Если p > 0.05, гипотеза не отвергается, указывая на равномерность. Метод применяется только к равномерному распределению, так как для нормального и экспоненциального требуются ожидаемые частоты из теоретических плотностей, что требует аппроксимации.

### Тест на независимость (автокорреляция)
Метод автокорреляции проверяет независимость последовательных чисел, вычисляя коэффициент корреляции Пирсона между значениями с лагом 1: corr = cov(x_i, x_{i+1}) / var(x). Для независимых чисел corr должен быть близок к 0 (абсолютное значение < 0.05). Это выявляет цикличность или зависимости в последовательности, что критично для качества ГПСЧ. Вычисление включает расчет среднего, дисперсии и ковариации по формулам, применимым ко всем распределениям.

### Поиск периода
Идея поиска периода — генерация длинной последовательности (100000 чисел) и проверка на повторяющиеся подпоследовательности с помощью `unordered_map` для хранения виденных значений и их индексов. Если найдена совпадающая подпоследовательность, возвращается её длина; иначе — период не найден. Это тестирует длину цикла ГПСЧ: хороший генератор имеет период, превышающий типичные размеры выборок, чтобы избежать повторений в симуляциях.

## Результаты тестирования
Генерировали 10000 чисел для основных тестов и 100000 для поиска периода. Все тесты выполнены в `test_rng.cpp` с выводом в консоль.

- **Визуализация равномерности (гистограмма)**:  
  Для равномерного распределения (нашего ГПСЧ): частоты в бинах [0.0-0.1): 1028, [0.1-0.2): 963, [0.2-0.3): 1020, [0.3-0.4): 1002, [0.4-0.5): 973, [0.5-0.6): 986, [0.6-0.7): 994, [0.7-0.8): 1022, [0.8-0.9): 990, [0.9-1.0): 1022. Частоты варьируются вокруг 1000 с отклонениями менее 5%, что соответствует теоретическому равномерному распределению без значимых пиков или провалов.  
  Для библиотечного: [1011, 1017, 978, 1044, 979, 1010, 977, 1000, 1029, 955] — аналогично равномерно, с вариацией, типичной для псевдослучайных последовательностей.  
  Для нормального N(0,1) (бины от -3 до 3, шаг 0.6): [60, 276, 880, 1619, 2261, 2193, 1565, 805, 267, 64]. Форма симметричного колокола с пиком около 0 (бины 4-5), убыванием к краям, что полностью соответствует теоретической плотности нормального распределения (см. рис. 1 в материалах).  
  Для экспоненциального (lambda=1, бины от 0 до 5, шаг 0.5): [4026, 2319, 1417, 898, 544, 291, 190, 115, 83, 45]. Сильное убывание частот от малых значений к большим, с большинством в первом бине, что согласуется с экспоненциальной плотностью p(t) = λ e^{-λt} для λ=1, где вероятность убывает экспоненциально.

- **Статистический тест на равномерность (хи-квадрат)**:  
  Для равномерного (нашего ГПСЧ): Вычислена χ² = 4.586 (сумма ((obs - 1000)² / 1000) по бинам), p-value = 0.8688 (p > 0.05, распределение равномерно, что подтверждает теорию о свойствах, близких к случайным).  
  Для библиотечного: χ² = 6.766, p-value = 0.6615 (p > 0.05, равномерно). Операции: расчет observed из гистограммы, expected = 1000, суммирование квадратов отклонений. Результаты согласуются с ожидаемыми для качественных ГПСЧ.

- **Независимость (автокорреляция)**:  
  Для равномерного (нашего ГПСЧ): corr = -0.0041 (близко к 0, независимы). Вычисления: mean = Σx_i / N ≈ 0.5, var = Σ(x_i - mean)² / N ≈ 0.0833, cov = Σ((x_i - mean)(x_{i+1} - mean)) / (N-1).  
  Для библиотечного: corr = 0.0025.  
  Для нормального: corr = -0.0116.  
  Для экспоненциального: corr = -0.0103. Все значения близки к 0 (менее 0.02 в абсолюте), что указывает на отсутствие зависимости, соответствующей теоретическим требованиям к псевдослучайным последовательностям.

- **Поиск периода**:  
  Не найден в 100000 числах (ожидаемо, так как алгоритм равномерного ГПСЧ имеет период > 2 млрд по описанию в материалах). Операции: использование `unordered_map` для поиска повторяющихся значений и проверки подпоследовательностей. Это подтверждает достаточную длину периода для практических применений.
